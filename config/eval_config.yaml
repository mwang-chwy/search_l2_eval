schema_mapping:
  search_id: qid_group
  part_number: sku
  rank: rank
  engagement: y_engagement    # Engagement labels (0,1,2,3)
  purchase: y_purchase        # Purchase labels (0,1)
  autoship: y_autoship       # Autoship labels (0,1)
  search_term: query_id  # Optional: will be included if exists

# PDM configuration
pdm:
  file_path: "data/PDM Product_2025-10-01-2037.csv"
  part_number_col: "PART_NUMBER"
  mc1_col: "MERCH_CLASSIFICATION1"
  mc2_col: "MERCH_CLASSIFICATION2"
  price_col: "PRICE"
  purchase_label: 1  # purchase column value that indicates purchase (1=purchased, 0=not purchased)

metrics:
  # Engagement NDCG using engagement labels (0,1,2,3)
  - name: ndcg_engagement
    params: { k: [10, 36, 72] }
    required_fields: [search_id, part_number, rank, engagement]
  
  # Purchase NDCG using purchase labels (0,1)  
  - name: ndcg_purchase
    params: { k: [10, 36, 72] }
    required_fields: [search_id, part_number, rank, purchase]
  
  # Autoship NDCG using autoship labels (0,1)
  - name: ndcg_autoship
    params: { k: [10, 36, 72] }
    required_fields: [search_id, part_number, rank, autoship]
  
  # CTR/CVR metrics
  - name: ctr
    params: { k: [8, 16, 32, 64], ctr_label: 1 }
    required_fields: [search_id, part_number, rank, engagement]
  - name: cvr
    params: { k: [8, 16, 32, 64], cvr_label: 1 }
    required_fields: [search_id, part_number, rank, purchase]
  
  # Revenue metrics
  - name: revenue_per_search
    params: { k: [8, 16, 32, 64] }
    required_fields: [search_id, part_number, rank, revenue]
  - name: revenue_per_purchased_search
    params: { k: [8, 16, 32, 64] }
    required_fields: [search_id, part_number, rank, purchase, revenue]
  - name: revenue_recall
    params: { k: [8, 16, 32, 64] }
    required_fields: [search_id, part_number, rank, revenue]
  - name: avg_price
    params: { k: [8, 16, 32, 64] }
    required_fields: [search_id, part_number, rank, price]

group_by: search_id
analyze_by_mc: true  # Enable MC-level analysis

output:
  aggregate: "results/aggregate_metrics.csv"
  per_query: "results/per_query_metrics.csv"
  mc1_analysis: "results/mc1_analysis.csv"
  mc2_analysis: "results/mc2_analysis.csv"
